"use strict";var _createClass=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var EventUtil={addHandler:function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},removeHandler:function(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=n},listenTouchDirection:function(t,o,i,a,r,s){var u,c;function e(t){switch(t.type){case"touchstart":u=t.touches[0].pageX,c=t.touches[0].pageY;break;case"touchend":var e=t.changedTouches[0].pageX-u,n=t.changedTouches[0].pageY-c;Math.abs(e)>Math.abs(n)?30<e?a&&a():e<-30&&s&&s():30<n?r&&r():n<-30&&i&&i();break;case"touchmove":o&&t.preventDefault()}}this.addHandler(t,"touchstart",e),this.addHandler(t,"touchend",e),this.addHandler(t,"touchmove",e)}},WorkBus=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.hatList=[],e.dotList=[],e}return _inherits(n,BaseWorkBus),_createClass(n,[{key:"addDot",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;for(console.log(e);0<e;){e--;var n=new Dot({left:t.l,top:t.t,radius:5,speed:10,className:"heart"});this.dotList.push(n)}}},{key:"addHat",value:function(t){this.hatList.push(t)}},{key:"addBiu",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;0<t;){t--;var e=this.list[this.list.length-1],n=new Biu({left:e.px,top:e.py,radius:10});this.add(n)}}},{key:"deleteDot",value:function(e){var t=this.dotList;this.dotList=t.filter(function(t){return t.key!==e})}},{key:"removeHat",value:function(e){var t=this.hatList;this.hatList=t.filter(function(t){return t.key!==e})}},{key:"playWork",value:function(){var o=this;if(this.times%200==9){var t=20*Math.random()+10,e=(6*Math.random()+2)/10,n=new Hat({width:t,height:t,left:e*winWidth,top:e*winHeight});this.addHat(n)}this.times++,this.isWorking=!0,this.iTimer=requestAnimationFrame(function(){o.change&&o.list.reduce(function(t,e){return t&&t.left?e.changePxy(t.left,t.top):e&&o.callBackFunc(e),e},null),o.dotList.forEach(function(t){t.dt>2*Math.PI?(t.destory(),o.deleteDot(t.key)):t.move()}),o.list.forEach(function(n,t){0===t&&(o.times%100==9&&n.changeColor(!1),o.hatList.forEach(function(t){if(collText(n.el,t.el)){t.destory(),o.removeHat(t.key);var e=Math.round(t.w/10);n.changeColor(!0),o.addBiu(e),o.addDot(t,e)}}),o.collectionFirst(n)),n.move()}),o.isWorking&&o.playWork()})}},{key:"collectionFirst",value:function(t){var e=t.el;e&&(e.offsetLeft<0?e.style.left=winWidth+"px":e.offsetLeft>winWidth?e.style.left="0px":e.offsetTop<0?e.style.top=winHeight+"px":e.offsetTop>winHeight&&(e.style.top="0px"))}}]),n}(),bus=new WorkBus;bus.playWork();for(var snakeNum=10;0<snakeNum;){snakeNum--;var t=winHeight/2+10*snakeNum,snake=new Biu({left:winWidth/2,top:t,radius:10});bus.add(snake)}function up(){bus.callFunc(function(t){return t.changeSpeed(0,-1)})}function right(){bus.callFunc(function(t){return t.changeSpeed(1,0)})}function down(){bus.callFunc(function(t){return t.changeSpeed(0,1)})}function left(){bus.callFunc(function(t){return t.changeSpeed(-1,0)})}document.body.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),document.addEventListener("touchstart",function(t){1<t.touches.length&&t.preventDefault()}),document.addEventListener("gesturestart",function(t){t.preventDefault()}),EventUtil.listenTouchDirection(document.body,!0,up,right,down,left);